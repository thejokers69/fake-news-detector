{% extends 'base.html' %}
{% block title %}Fake News Detector - Home{% endblock %}
{% block content %}
<!-- Hero Section -->
<section class="hero-section">
  <div class="container">
    <div class="row justify-content-center text-center">
      <div class="col-lg-8">
        <h1 class="display-4 fw-bold mb-4">
          <i class="fa-solid fa-magnifying-glass me-3"></i>
          Fake News Detector
        </h1>
        <p class="lead mb-4">
          Automatically analyze the veracity of news articles using machine learning.
        </p>
        <div class="row text-center mb-4">
          <div class="col-md-4">
            <div class="mb-3">
              <i class="fa-solid fa-brain text-warning fa-2x"></i>
            </div>
            <h5>Machine Learning</h5>
            <small class="text-muted">Model trained on 45,000 articles</small>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <i class="fa-solid fa-gauge-high text-success fa-2x"></i>
            </div>
            <h5>98.9% Accuracy</h5>
            <small class="text-muted">LogisticRegression + TF-IDF</small>
          </div>
          <div class="col-md-4">
            <div class="mb-3">
              <i class="fa-solid fa-clock text-info fa-2x"></i>
            </div>
            <h5>Instant Analysis</h5>
            <small class="text-muted">Results in seconds</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Main Analysis Section -->
<section class="py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-primary text-white text-center py-4">
            <h2 class="h4 mb-0">
              <i class="fa-solid fa-newspaper me-2"></i>
              Analyze an Article
            </h2>
          </div>
          <div class="card-body p-4">
            <p class="text-muted mb-4 text-center">
              Paste the text of a news article below to check if it's fake news.
            </p>

            <form method="post" action="{% url 'detector:home' %}">
              {% csrf_token %}
              <div class="mb-4">
                <label for="news_text" class="form-label fw-bold">
                  <i class="fa-solid fa-file-text me-2"></i>
                  Article text:
                </label>
                <textarea
                  class="form-control"
                  id="news_text"
                  name="news_text"
                  rows="8"
                  placeholder="Paste here the title and content of the article to analyze..."
                  required
                ></textarea>
                <div class="form-text">
                  <small class="text-muted">
                    <i class="fa-solid fa-info-circle me-1"></i>
                    The longer the text, the more accurate the analysis will be.
                  </small>
                </div>
              </div>

              <div class="d-grid d-md-flex justify-content-md-center gap-3">
                <button type="submit" class="btn btn-primary btn-lg px-5">
                  <i class="fa-solid fa-magnifying-glass me-2"></i>
                  Analyze Article
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  onclick="clearText()"
                >
                  <i class="fa-solid fa-eraser me-2"></i>
                  Clear
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Results Section -->
{% if prediction %}
<section class="py-5 bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10">
        {% if prediction.label == 'Erreur' %}
        <!-- Error Result -->
        <div class="card result-card error-result mb-4">
          <div class="card-body p-4 text-center">
            <div class="mb-3">
              <i class="fa-solid fa-triangle-exclamation text-warning fa-3x"></i>
            </div>
            <h3 class="text-warning mb-3">Analysis Error</h3>
            <p class="text-muted mb-0">
              {{ prediction.error|default:"An error occurred during analysis." }}
            </p>
          </div>
        </div>
        {% else %}
        {% if prediction.label == 'Fake' %}
        <!-- Fake Result -->
        <div class="card result-card mb-4 fake-result">
          <div class="card-body p-4 text-center">
            <div class="result-icon mb-4">
              <i class="fa-solid fa-triangle-exclamation fa-4x text-danger"></i>
            </div>

            <h2 class="mb-3 text-danger">
              Article suspected of disinformation
            </h2>

            <p class="lead text-muted mb-4">
              LogisticRegression model (TF-IDF bi-grams) trained on datasets.
            </p>

            <!-- Result Badge and Confidence -->
            <div class="d-flex justify-content-center align-items-center gap-4 mb-4">
              <span class="badge rounded-pill fs-6 px-4 py-2 bg-danger">
                Fake
              </span>
              <div class="text-center">
                <div class="h5 mb-1">Confidence: {{ prediction.confidence_percent }}%</div>
                <small class="text-muted">Model certainty level</small>
              </div>
            </div>

            <!-- Confidence Progress Bar -->
            <div class="confidence-bar bg-light mb-4" role="progressbar">
              <div
                class="progress-bar bg-danger"
                style="width: {{ prediction.confidence_percent }}%"
                aria-valuenow="{{ prediction.confidence_percent }}"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
        {% else %}
        <!-- Real Result -->
        <div class="card result-card mb-4 real-result">
          <div class="card-body p-4 text-center">
            <div class="result-icon mb-4">
              <i class="fa-solid fa-shield-check fa-4x text-success"></i>
            </div>

            <h2 class="mb-3 text-success">
              Article probably authentic
            </h2>

            <p class="lead text-muted mb-4">
              LogisticRegression model (TF-IDF bi-grams) trained on datasets.
            </p>

            <!-- Result Badge and Confidence -->
            <div class="d-flex justify-content-center align-items-center gap-4 mb-4">
              <span class="badge rounded-pill fs-6 px-4 py-2 bg-success">
                Real
              </span>
              <div class="text-center">
                <div class="h5 mb-1">Confidence: {{ prediction.confidence_percent }}%</div>
                <small class="text-muted">Model certainty level</small>
              </div>
            </div>

            <!-- Confidence Progress Bar -->
            <div class="confidence-bar bg-light mb-4" role="progressbar">
              <div
                class="progress-bar bg-success"
                style="width: {{ prediction.confidence_percent }}%"
                aria-valuenow="{{ prediction.confidence_percent }}"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Input Preview -->
        {% if prediction.input_preview %}
        <div class="card shadow-sm">
          <div class="card-header">
            <h6 class="mb-0">
              <i class="fa-solid fa-file-text me-2"></i>
              Analyzed excerpt ({{ prediction.input_length }} characters){% if prediction.input_length > 240 %}â€¦{% endif %}
            </h6>
          </div>
          <div class="card-body">
            <blockquote class="blockquote mb-0">
              <p class="mb-0 text-muted fst-italic">
                "{{ prediction.input_preview }}"
              </p>
            </blockquote>
          </div>
        </div>
        {% endif %}
        {% endif %}

        <!-- Analyze Another Button -->
        <div class="text-center mt-4">
          <button type="button" class="btn btn-outline-primary" onclick="clearForm()">
            <i class="fa-solid fa-plus me-2"></i>
            Analyze Another Article
          </button>
        </div>
      </div>
    </div>
  </div>
</section>
{% endif %}

<!-- Info Section -->
<section class="py-5 bg-light">
  <div class="container">
    <div class="row g-4">
      <div class="col-md-4">
        <div class="info-card card h-100 p-4 text-center">
          <div class="icon-pill bg-primary text-white mx-auto mb-3">
            <i class="fa-solid fa-chart-line"></i>
          </div>
          <h5 class="card-title">Model Metrics</h5>
          <div class="row text-center">
            <div class="col-6">
              <div class="h4 text-success">98.9%</div>
              <small class="text-muted">Accuracy</small>
            </div>
            <div class="col-6">
              <div class="h4 text-primary">45K</div>
              <small class="text-muted">Articles</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="info-card card h-100 p-4 text-center">
          <div class="icon-pill bg-success text-white mx-auto mb-3">
            <i class="fa-solid fa-server"></i>
          </div>
          <h5 class="card-title">Technology</h5>
          <p class="card-text text-muted">
            Built with Django, scikit-learn and NLTK. LogisticRegression model
            with TF-IDF vectorization.
          </p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="info-card card h-100 p-4 text-center">
          <div class="icon-pill bg-warning text-dark mx-auto mb-3">
            <i class="fa-solid fa-flask"></i>
          </div>
          <h5 class="card-title">Deployment</h5>
          <p class="card-text text-muted">
            Application deployed on Heroku with CI/CD. Responsive and accessible
            interface.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  function clearText() {
    document.getElementById("news_text").value = "";
    document.getElementById("news_text").focus();
  }

  function clearForm() {
    document.getElementById("news_text").value = "";
    document.getElementById("news_text").focus();
    // Scroll to top to show the form again
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
</script>
{% endblock %}
